<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BIMBO Educational System Converter PRO</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        /* --- تعريف المتغيرات والألوان (Themes) --- */
        :root {
            --bg: #f4f6f8;
            --card: #ffffff;
            --primary: #6c5ce7;
            --secondary: #00cec9;
            --accent: #fdcb6e;
            --text: #2d3436;
            --border: #dfe6e9;
            --shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        body.dark {
            --bg: #1e272e;
            --card: #2f3640;
            --text: #f5f6fa;
            --border: #3d3d3d;
            --shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; transition: 0.3s; }

        body {
            background: var(--bg);
            margin: 0;
            padding: 20px;
            color: var(--text);
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        /* --- جسم الآلة --- */
        .machine {
            width: 100%;
            max-width: 900px;
            background: var(--card);
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        /* --- الهيدر --- */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--border);
            padding-bottom: 20px;
            margin-bottom: 20px;
        }

        .logo { display: flex; gap: 15px; align-items: center; }
        .logo i { font-size: 2.5rem; color: var(--primary); }
        .logo-text strong { font-size: 1.2rem; display: block; }
        .logo-text small { color: var(--secondary); font-weight: bold; }

        .toggle-btn {
            cursor: pointer;
            font-size: 1.5rem;
            color: var(--text);
            background: var(--bg);
            padding: 10px;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- مدخلات البيانات --- */
        .inputs-area {
            display: grid;
            grid-template-columns: 2fr 1fr auto auto;
            gap: 15px;
            margin-bottom: 25px;
        }

        @media (max-width: 600px) {
            .inputs-area { grid-template-columns: 1fr; }
        }

        input, select, button {
            padding: 12px 15px;
            border-radius: 8px;
            border: 2px solid var(--border);
            font-size: 1rem;
            background: var(--bg);
            color: var(--text);
            outline: none;
            font-weight: bold;
        }

        input:focus { border-color: var(--primary); }

        button {
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-convert { background: linear-gradient(135deg, var(--primary), #a29bfe); }
        .btn-pdf { background: linear-gradient(135deg, #e17055, #fab1a0); }
        button:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }

        /* --- القسم التعليمي (Algorithm & Flowchart) --- */
        .education-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        @media (max-width: 700px) {
            .education-section { grid-template-columns: 1fr; }
        }

        .edu-card {
            background: var(--bg);
            padding: 15px;
            border-radius: 12px;
            border: 1px dashed var(--border);
        }

        .edu-card h3 { margin-top: 0; color: var(--primary); border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        
        /* Flowchart Shapes */
        .flow-box { padding: 8px 15px; margin: 5px auto; width: 80%; text-align: center; border-radius: 20px; font-weight: bold; font-size: 0.9rem; position: relative; }
        .flow-box::after { content: '↓'; display: block; position: absolute; bottom: -18px; left: 50%; transform: translateX(-50%); color: var(--text); opacity: 0.5; }
        .flow-box:last-child::after { content: ''; }

        .start { background: #55efc4; color: #2d3436; border-radius: 25px; }
        .proc { background: #74b9ff; color: white; border-radius: 5px; }
        .decis { background: #ffeaa7; color: #2d3436; transform: rotate(-2deg); width: 70%; }
        .end { background: #ff7675; color: white; border-radius: 25px; }

        /* --- الخطوات والنتائج --- */
        .steps-container {
            background: var(--bg);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            max-height: 300px;
            overflow-y: auto;
            border-left: 5px solid var(--secondary);
        }

        .step-item {
            font-family: 'Courier New', monospace;
            padding: 5px 0;
            border-bottom: 1px solid var(--border);
            direction: ltr;
            text-align: left;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .result-box {
            background: #2d3436;
            color: #00ff9d;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            position: relative;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }

        .result-label {
            color: #f1c40f;
            font-size: 0.8rem;
            display: block;
            margin-bottom: 5px;
        }

        .copy-icon {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            opacity: 0.5;
        }
        .copy-icon:hover { opacity: 1; transform: scale(1.2); }

        /* --- الفوتر والتاريخ --- */
        .history-section { font-size: 0.9rem; opacity: 0.8; margin-bottom: 20px; }
        footer { text-align: center; margin-top: 30px; font-size: 0.85rem; color: var(--text); opacity: 0.6; border-top: 1px solid var(--border); padding-top: 20px; }
    </style>
</head>

<body>

    <div class="machine" id="pdfContent">
        <header>
            <div class="logo">
                <i class="fas fa-microchip"></i>
                <div class="logo-text">
                    <strong>BIMBO Converter PRO</strong>
                    <small>Educational Tool v3.0</small>
                </div>
            </div>
            <div class="toggle-btn" onclick="toggleMode()">
                <i class="fas fa-moon"></i>
            </div>
        </header>

        <div class="inputs-area" data-html2canvas-ignore="true">
            <input type="text" id="numInput" placeholder="أدخل الرقم (مثال: 10.5)">
            <select id="baseSelect">
                <option value="10">Decimal (10)</option>
                <option value="2">Binary (2)</option>
                <option value="8">Octal (8)</option>
                <option value="16">Hex (16)</option>
            </select>
            <button class="btn-convert" onclick="runConversion()">
                <i class="fas fa-sync-alt"></i> Convert
            </button>
            <button class="btn-pdf" onclick="exportToPDF()">
                <i class="fas fa-file-pdf"></i> PDF
            </button>
        </div>

        <div class="education-section">
            <div class="edu-card">
                <h3><i class="fas fa-code"></i> Algorithm Logic</h3>
                <ol style="padding-right: 20px;">
                    <li><b>Start:</b> Read input number & base.</li>
                    <li><b>Validation:</b> Check if digits match base.</li>
                    <li><b>Process 1:</b> Convert Integer part to Decimal.</li>
                    <li><b>Process 2:</b> Convert Fractional part (if any).</li>
                    <li><b>Output:</b> Convert Decimal to (BIN, OCT, HEX).</li>
                    <li><b>End:</b> Display results & steps.</li>
                </ol>
            </div>
            <div class="edu-card" style="text-align:center">
                <h3><i class="fas fa-project-diagram"></i> Flowchart</h3>
                <div class="flow-box start">Start</div>
                <div class="flow-box proc">Input N, Base</div>
                <div class="flow-box decis">Valid?</div>
                <div class="flow-box proc">Processing...</div>
                <div class="flow-box end">Stop</div>
            </div>
        </div>

        <h4 style="margin-bottom:10px; color:var(--primary)">Detailed Steps (خطوات الحل):</h4>
        <div class="steps-container" id="stepsOutput">
            <div style="text-align:center; opacity:0.5;">اضغط Convert لعرض الخطوات...</div>
        </div>

        <div class="results-grid" id="resultsOutput"></div>

        <div class="history-section" id="historyOutput">
            <strong><i class="fas fa-history"></i> Recent History:</strong> <span style="font-size:0.8rem">(No history yet)</span>
        </div>

        <footer>
            Developed with <i class="fas fa-heart" style="color:red"></i> by <b>Eng/Adham Sayed</b> © 2026<br>
            Rights Reserved to <b>BIMBO Organization</b>
        </footer>
    </div>

    <script>
        let historyLog = [];

        // 1. تبديل الوضع الليلي
        function toggleMode() {
            document.body.classList.toggle("dark");
            const icon = document.querySelector(".toggle-btn i");
            if(document.body.classList.contains("dark")){
                icon.classList.remove("fa-moon");
                icon.classList.add("fa-sun");
            } else {
                icon.classList.remove("fa-sun");
                icon.classList.add("fa-moon");
            }
        }

        // 2. دالة التحويل الذكية (تتعامل مع الكسور بدقة)
        function anyBaseToDecimal(str, base) {
            let [intPart, fracPart] = str.split('.');
            let integerValue = parseInt(intPart, base);
            if (isNaN(integerValue)) return NaN;
            
            let fractionalValue = 0;
            if (fracPart) {
                for (let i = 0; i < fracPart.length; i++) {
                    let digit = parseInt(fracPart[i], base);
                    if (isNaN(digit)) return NaN;
                    fractionalValue += digit * Math.pow(base, -(i + 1));
                }
            }
            return integerValue + fractionalValue;
        }

        // 3. دالة توليد خطوات الحل (HTML)
        function generateSteps(numStr, base, decimalVal) {
            if(base === 10) return "<div class='step-item'>الرقم مدخل بالنظام العشري بالفعل.</div>";
            
            let html = "";
            let [intPart, fracPart] = numStr.split('.');

            // خطوات الصحيح
            html += `<strong>[1] الجزء الصحيح (${intPart}):</strong><br>`;
            let chars = intPart.toUpperCase().split('').reverse();
            let intSum = 0;
            chars.forEach((char, index) => {
                let val = parseInt(char, base);
                let res = val * Math.pow(base, index);
                intSum += res;
                html += `<div class='step-item'>Digit (${char}) × ${base}<sup>${index}</sup> = ${res}</div>`;
            });

            // خطوات الكسر
            if(fracPart) {
                html += `<br><strong>[2] الجزء الكسري (0.${fracPart}):</strong><br>`;
                let fChars = fracPart.toUpperCase().split('');
                fChars.forEach((char, index) => {
                    let val = parseInt(char, base);
                    let p = -(index + 1);
                    let res = val * Math.pow(base, p);
                    html += `<div class='step-item'>Digit (${char}) × ${base}<sup>${p}</sup> = ${res.toFixed(5)}...</div>`;
                });
            }

            html += `<br><div class='step-item' style='color:var(--secondary); font-weight:bold'>Total Decimal Value ≈ ${decimalVal}</div>`;
            return html;
        }

        // 4. الدالة الرئيسية للتنفيذ
        function runConversion() {
            const numInput = document.getElementById("numInput").value.trim();
            const base = parseInt(document.getElementById("baseSelect").value);
            const stepsDiv = document.getElementById("stepsOutput");
            const resultsDiv = document.getElementById("resultsOutput");

            if(!numInput) { alert("أدخل رقماً أولاً يا هندسة!"); return; }

            // التحويل
            let decValue = anyBaseToDecimal(numInput, base);

            if(isNaN(decValue)) {
                resultsDiv.innerHTML = "<div style='color:red; grid-column:span 4; text-align:center'>خطأ: الرقم لا يتوافق مع النظام المختار!</div>";
                return;
            }

            // عرض الخطوات
            stepsDiv.innerHTML = generateSteps(numInput, base, decValue);

            // عرض النتائج
            resultsDiv.innerHTML = `
                <div class="result-box">
                    <span class="result-label">DECIMAL (10)</span>
                    ${decValue}
                    <i class="fas fa-copy copy-icon" onclick="copyText('${decValue}', this)"></i>
                </div>
                <div class="result-box">
                    <span class="result-label">BINARY (2)</span>
                    ${decValue.toString(2)}
                    <i class="fas fa-copy copy-icon" onclick="copyText('${decValue.toString(2)}', this)"></i>
                </div>
                <div class="result-box">
                    <span class="result-label">OCTAL (8)</span>
                    ${decValue.toString(8)}
                    <i class="fas fa-copy copy-icon" onclick="copyText('${decValue.toString(8)}', this)"></i>
                </div>
                <div class="result-box">
                    <span class="result-label">HEXADECIMAL (16)</span>
                    ${decValue.toString(16).toUpperCase()}
                    <i class="fas fa-copy copy-icon" onclick="copyText('${decValue.toString(16).toUpperCase()}', this)"></i>
                </div>
            `;

            // إضافة للتاريخ
            updateHistory(`${numInput}<sub>(${base})</sub> → ${decValue}<sub>(10)</sub>`);
        }

        // 5. إدارة التاريخ
        function updateHistory(entry) {
            historyLog.unshift(entry);
            if(historyLog.length > 5) historyLog.pop();
            document.getElementById("historyOutput").innerHTML = 
                "<strong><i class='fas fa-history'></i> Recent History:</strong><br>" + 
                historyLog.join("<hr style='margin:5px 0; opacity:0.1'>");
        }

        // 6. النسخ
        function copyText(text, iconElement) {
            navigator.clipboard.writeText(text);
            let originalClass = iconElement.className;
            iconElement.className = "fas fa-check";
            setTimeout(() => { iconElement.className = originalClass; }, 1000);
        }

        // 7. تصدير PDF
        function exportToPDF() {
            const element = document.getElementById('pdfContent');
            const opt = {
                margin:       0.3,
                filename:     'BIMBO_Report.pdf',
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2 },
                jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
            };
            html2pdf().set(opt).from(element).save();
        }
    </script>

</body>
</html>
